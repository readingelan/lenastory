<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë°•ì •í˜„ ë”°ë¼í•˜ë¦¬ë‚˜ â€“ Shadowing</title>

<style>
  body {
    margin: 0;
    padding: 20px;
    background: #0e0e0e;
    color: #eee;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  .container {
    max-width: 760px;
    margin: 0 auto;
  }

  .video-wrapper {
    position: relative;
    padding-top: 56.25%;
    margin-bottom: 20px;
  }

  .video-wrapper iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
  }

  .shadow-box {
    background: #1c1c1c;
    border-radius: 16px;
    padding: 26px;
    text-align: center;
  }

  .title {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 6px;
  }

  .subtitle {
    font-size: 0.95rem;
    color: #bbb;
    margin-bottom: 18px;
  }

  select {
    padding: 6px 10px;
    border-radius: 8px;
    border: none;
    margin-bottom: 14px;
  }

  .modes button,
  .controls button {
    padding: 8px 12px;
    margin: 4px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  .active {
    background: #444;
    color: #fff;
  }

  .sentence {
    font-size: 1.4rem;
    line-height: 1.6;
    min-height: 4.2em;
    margin: 14px 0;
  }

  .status {
    font-size: 0.9rem;
    color: #aaa;
    margin-bottom: 12px;
  }

  .progress {
    font-size: 0.8rem;
    color: #888;
    margin-top: 8px;
  }
</style>
</head>

<body>
<div class="container">

  <!-- ì˜ìƒ -->
  <div class="video-wrapper">
    <iframe
      id="player"
      src="https://www.youtube.com/embed/XyuuezDhQgs?enablejsapi=1&start=61"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>

  <!-- ì‰ë„ì‰ ë°•ìŠ¤ -->
  <div class="shadow-box">

    <!-- íƒ€ì´í‹€ -->
    <div id="titleBox">
      <div class="title">ë°•ì •í˜„ ë”°ë¼í•˜ë¦¬ë‚˜ âœï¸ğŸ“–ğŸ§</div>
      <div class="subtitle">English Shadowing Practice</div>
    </div>

    <!-- ì±•í„° ì„ íƒ -->
    <select id="chapterSelect" onchange="changeChapter()">
      <option value="0">Chapter 1</option>
      <option value="1">Chapter 2</option>
    </select>

    <!-- ëª¨ë“œ -->
    <div class="modes">
      <button onclick="setMode(1)" id="mode1">Full</button>
      <button onclick="setMode(2)" id="mode2">Blanks</button>
      <button onclick="setMode(3)" id="mode3">Hidden</button>
    </div>

    <div class="sentence" id="sentenceBox"></div>
    <div class="status" id="statusText">â­ Next to start</div>

    <div class="controls">
      <button onclick="prevSentence()">â®</button>
      <button onclick="playSentence()">â–¶</button>
      <button onclick="repeatSentence()">ğŸ”</button>
      <button onclick="nextSentence()">â­</button>
    </div>

    <div class="progress" id="progressText"></div>
  </div>
</div>

<script>
let player;
let currentIndex = -1;
let mode = 1;
let stopTimer;

const chapters = [
  [
    { text: "Snow White and the Seven Dwarfs", start: 61, end: 64 },
    { text: "Once upon a time, a princess was born in a kingdom far away.", start: 64, end: 71 },
    { text: "The queen had long wished for a daughter with skin like snow.", start: 71, end: 77 },
    { text: "Her wish had come true, and she named the princess Snow White.", start: 82, end: 88 },
    { text: "Sadly, the queen passed away not long after Snow White was born.", start: 88, end: 95 }
  ],
  [
    { text: "This gave the queen a great shock.", start: 187, end: 190 },
    { text: "Her heart filled with jealousy and hatred.", start: 190, end: 195 },
    { text: "She ordered a huntsman to take Snow White into the woods.", start: 209, end: 215 }
  ]
];

let sentences = chapters[0];

// ì£¼ìš” ë‹¨ì–´ë§Œ ë¹ˆì¹¸ ì²˜ë¦¬
function makeBlanks(text) {
  return text.replace(
    /\b(?!the\b|and\b|for\b|with\b|that\b|this\b|from\b|into\b|upon\b)([A-Za-z]{4,})\b/gi,
    "____"
  );
}

function onYouTubeIframeAPIReady() {
  player = new YT.Player("player");
  setMode(1);
  updateUI();
}

function playSentence() {
  if (currentIndex < 0) return;
  clearTimeout(stopTimer);
  const s = sentences[currentIndex];

  player.seekTo(s.start, true);
  player.playVideo();
  statusText.innerText = "â–¶ Listening...";

  stopTimer = setTimeout(() => {
    player.pauseVideo();
    statusText.innerText = "ğŸ¤ Now shadow";
  }, (s.end - s.start) * 1000);
}

function repeatSentence() { playSentence(); }

function nextSentence() {
  if (currentIndex < sentences.length - 1) {
    currentIndex++;
    updateUI();
  }
}

function prevSentence() {
  if (currentIndex > -1) {
    currentIndex--;
    updateUI();
  }
}

function setMode(m) {
  mode = m;
  document.querySelectorAll(".modes button").forEach(b => b.classList.remove("active"));
  document.getElementById(`mode${m}`).classList.add("active");
  updateSentence();
}

function updateSentence() {
  if (currentIndex < 0) {
    sentenceBox.innerText = "";
    return;
  }
  const t = sentences[currentIndex].text;
  sentenceBox.innerText =
    mode === 1 ? t :
    mode === 2 ? makeBlanks(t) : "";
}

function updateUI() {
  if (currentIndex < 0) {
    titleBox.style.display = "block";
    progressText.innerText = "";
    statusText.innerText = "â­ Next to start";
  } else {
    titleBox.style.display = "none";
    updateSentence();
    progressText.innerText = `Sentence ${currentIndex + 1} / ${sentences.length}`;
    statusText.innerText = "â–¶ Press play";
  }
}

function changeChapter() {
  const idx = chapterSelect.value;
  sentences = chapters[idx];
  currentIndex = -1;
  updateUI();
}

// YouTube API
const tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);
</script>

</body>
</html>
