<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë°•ì •í˜„ ë”°ë¼í•˜ë¦¬ë‚˜ â€“ Shadowing</title>

<style>
  body {
    margin: 0;
    padding: 20px;
    background: #0e0e0e;
    color: #eee;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  .container {
    max-width: 760px;
    margin: 0 auto;
  }

  .video-wrapper {
    position: relative;
    padding-top: 56.25%;
    margin-bottom: 20px;
  }

  .video-wrapper iframe {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
  }

  .shadow-box {
    background: #1c1c1c;
    border-radius: 18px;
    padding: 28px;
    text-align: center;
  }

  .title {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 6px;
  }

  .subtitle {
    font-size: 0.95rem;
    color: #bbb;
    margin-bottom: 18px;
  }

  select {
    padding: 6px 10px;
    border-radius: 8px;
    border: none;
    margin-bottom: 14px;
  }

  .modes button {
    padding: 6px 10px;
    margin: 4px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  .active {
    background: #444;
    color: #fff;
  }

  .sentence {
    font-size: 1.45rem;
    line-height: 1.6;
    min-height: 4.2em;
    margin: 16px 0;
  }

  .status {
    font-size: 0.9rem;
    color: #aaa;
    margin-bottom: 18px;
  }

  /* ğŸ”´ ë©”ì¸ ì‰ë„ì‰ ë²„íŠ¼ */
  .record-btn {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background: #d93025;
    color: white;
    font-size: 2.2rem;
    border: none;
    cursor: pointer;
  }

  .record-btn.pause {
    background: #555;
  }

  .nav-btn {
    padding: 6px 10px;
    margin: 6px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  .progress {
    font-size: 0.8rem;
    color: #888;
    margin-top: 10px;
  }
</style>
</head>

<body>
<div class="container">

  <!-- ì˜ìƒ -->
  <div class="video-wrapper">
    <iframe
      id="player"
      src="https://www.youtube.com/embed/XyuuezDhQgs?enablejsapi=1&start=61"
      frameborder="0"
      allowfullscreen>
    </iframe>
  </div>

  <!-- ì‰ë„ì‰ ë°•ìŠ¤ -->
  <div class="shadow-box">

    <!-- íƒ€ì´í‹€ -->
    <div id="titleBox">
      <div class="title">ë°•ì •í˜„ ë”°ë¼í•˜ë¦¬ë‚˜ âœï¸ğŸ“–ğŸ§</div>
      <div class="subtitle">English Shadowing Practice</div>
    </div>

    <!-- ì±•í„° -->
    <select id="chapterSelect" onchange="changeChapter()">
      <option value="0">Chapter 1</option>
    </select>

    <!-- ëª¨ë“œ -->
    <div class="modes">
      <button onclick="setMode(1)" id="mode1">Full</button>
      <button onclick="setMode(2)" id="mode2">Blanks</button>
      <button onclick="setMode(3)" id="mode3">Hidden</button>
    </div>

    <div class="sentence" id="sentenceBox"></div>
    <div class="status" id="statusText">â­ Next to start</div>

    <!-- ì»¨íŠ¸ë¡¤ -->
    <div>
      <button class="nav-btn" onclick="prevSentence()">â®</button>

      <button
        class="record-btn"
        id="recordBtn"
        onclick="handleRecordClick()">
        ğŸ”´
      </button>

      <button class="nav-btn" onclick="nextSentence()">â­</button>
    </div>

    <div class="progress" id="progressText"></div>
  </div>
</div>

<script>
let player;
let currentIndex = -1;
let mode = 1;
let stopTimer;
let isPlaying = false;

const chapters = [[
  { text: "Snow White and the Seven Dwarfs", start: 61, end: 64 },
  { text: "Once upon a time, a princess was born in a kingdom far away.", start: 64, end: 71 },
  { text: "The queen had long wished for a daughter with skin like snow.", start: 71, end: 77 },
  { text: "Her wish had come true, and she named the princess Snow White.", start: 82, end: 88 }
]];

let sentences = chapters[0];

function makeBlanks(text) {
  return text.replace(
    /\b(?!the\b|and\b|for\b|with\b|that\b|this\b|from\b|into\b)([A-Za-z]{4,})\b/gi,
    "____"
  );
}

function onYouTubeIframeAPIReady() {
  player = new YT.Player("player");
  setMode(1);
  updateUI();
}

function autoPlayCurrent() {
  playSentence(true);
}

function playSentence(auto = false) {
  if (currentIndex < 0) return;

  clearTimeout(stopTimer);
  const s = sentences[currentIndex];
  isPlaying = true;

  recordBtn.innerText = "â¸";
  recordBtn.classList.add("pause");

  player.seekTo(s.start, true);
  player.playVideo();
  statusText.innerText = "â–¶ Listening...";

  stopTimer = setTimeout(() => {
    player.pauseVideo();
    isPlaying = false;
    recordBtn.innerText = "ğŸ”´";
    recordBtn.classList.remove("pause");
    statusText.innerText = "ğŸ¤ Shadow now";
  }, (s.end - s.start) * 1000);
}

function handleRecordClick() {
  if (isPlaying) return;
  playSentence();
}

function nextSentence() {
  if (currentIndex < sentences.length - 1) {
    currentIndex++;
    updateUI();
    autoPlayCurrent();
  }
}

function prevSentence() {
  if (currentIndex > 0) {
    currentIndex--;
    updateUI();
  }
}

function setMode(m) {
  mode = m;
  document.querySelectorAll(".modes button").forEach(b => b.classList.remove("active"));
  document.getElementById(`mode${m}`).classList.add("active");
  updateSentence();
}

function updateSentence() {
  if (currentIndex < 0) {
    sentenceBox.innerText = "";
    return;
  }
  const t = sentences[currentIndex].text;
  sentenceBox.innerText =
    mode === 1 ? t :
    mode === 2 ? makeBlanks(t) : "";
}

function updateUI() {
  if (currentIndex < 0) {
    titleBox.style.display = "block";
    statusText.innerText = "â­ Next to start";
    progressText.innerText = "";
  } else {
    titleBox.style.display = "none";
    updateSentence();
    statusText.innerText = "â–¶ Listening...";
    progressText.innerText = `Sentence ${currentIndex + 1} / ${sentences.length}`;
  }
}

function changeChapter() {
  sentences = chapters[chapterSelect.value];
  currentIndex = -1;
  updateUI();
}

// ìµœì´ˆ Next í´ë¦­ ì‹œ ì²« ë¬¸ì¥ ìë™ ì‹œì‘
function nextSentence() {
  if (currentIndex < sentences.length - 1) {
    currentIndex++;
    updateUI();
    autoPlayCurrent();
  }
}

// YouTube API
const tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);
</script>

</body>
</html>
